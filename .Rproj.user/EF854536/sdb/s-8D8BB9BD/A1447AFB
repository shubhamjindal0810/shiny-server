{
    "contents" : "\n# This is the server logic for a Shiny web application.\n# You can find out more about building applications with Shiny here:\n#\n# http://shiny.rstudio.com\n#\n\nlibrary(shiny)\n\noptions(shiny.maxRequestSize = 9*1024^2)\n\nshinyServer(function(input, output, session) {\n  output$contents <- renderTable({\n    # input$file1 will be NULL initially. After the user selects\n    # and uploads a file, it will be a data frame with 'name',\n    # 'size', 'type', and 'datapath' columns. The 'datapath'\n    # column will contain the local filenames where the data can\n    # be found.\n    library(data.table)   \n    inFile <- input$file1\n    if (is.null(inFile))\n      return(NULL)\n    write.csv( data.table(read.csv( inFile$datapath )), \"~/shiny-server/data.csv\")\n    read.csv(inFile$datapath)\n  })\n  \n  begin <- eventReactive(input$begin, {\n    plotImage <- function( metadata, logo, img1, barcodeSKU, SKU, blank = 0,  plotLogo = 1 ){\n     setwd('~/shiny-server')\n\t plot( 1 : 2, type = 'n', yaxt = 'n', xaxt = 'n', ylab = '', xlab = '', bty = 'n' )#for no border\n      if( blank == 0 ){\n        text( 1, 1.77, metadata, pos = 4, cex = 0.75)\n        if( plotLogo == 1) rasterImage( logo, 1.61, 1.67, 2.0 , 1.84 )\n        rasterImage( img1, 0.94, 1.19, 2.06, 1.64 )\n        text( 1.5, 1.12, paste( \"AMAZON FNSKU :\", barcodeSKU ), cex = 0.85 )\n        #rasterImage( img2, 1.001, 1.1, 1.999, 1.3 )\n        text( 1.5, 1.03, paste( \"SKU:\", SKU ) , cex = 0.85 )\n        #box( )#lty = '1373', col = 'black' )\n      }\n    }\n    library( data.table )\n    library( rPython )\n    library( png )\n    pythonCode <- \"~/shiny-server/python.py\"\n    pythonFunction <- \"jindsh\"\n    \n    tempImageName <- \"temp.png\"\n    orderFile <- \"~/shiny-server/data.csv\"\n    plotLogo = 1\n    \n    order <- data.table( read.csv( orderFile ) )\n    code <- readChar( pythonCode, nchars = 100000 )\n    python.exec( code )\n    pdf( file = \"test.pdf\", onefile = TRUE, paper = \"a4\", bg = \"white\", width = 7.8, height = 11 )\n    par( mfrow = c( 8, 3 ), mar = rep( 0.5, 4 ) )\n    \n    for ( i in 1 : nrow( order ) ){\n      if( order$Quantity[ i ] > 0 ){\n        barcodeSKU <- order$fnsku[ i ]\n        SKU <- order$sku[ i ]\n        python.call( pythonFunction, barcodeSKU, tempImageName )\n        img1 <- readPNG( tempImageName )\n        name <- order$product.name[ i ]\n        gen <- \"Imported by Jindal Trading Company, Hyderabad\"\n        mrp <- paste( \"MRP: \", order$MRP[ i ], \" INR\", sep = \"\" )\n        month <- paste( \"Import Month : \", order$Import.Month[ i ], sep = \"\" )\n        logoImage <- paste( order$Brand..Wizzit.JT.dbrand.None.[ i ], \".png\", sep = \"\" )\n        logo <- readPNG( logoImage )\n        metadata <- paste( gen, mrp, name, month, sep = \"\\n\" )\n        for ( j in 1 : order$Quantity[ i ] ){\n          plotImage( metadata, logo, img1, barcodeSKU, SKU, plotLogo = plotLogo )\n        }\n        k = 3 - j%%3\n        for( l in 1 : k ){\n          plotImage( metadata, logo, img1, barcodeSKU, SKU, blank = 1, plotLogo = plotLogo )\n        }\n      }\n    }\n    dev.off( )\n    \"Done\"\n    \n  })\n  \n  output$status <- renderText({\n    begin()\n  })\n  \n  \n  output$downloadData <- downloadHandler(\n    filename = function() { \n      'stickers.pdf'\n    },\n    content = function(file) {\n      file.copy('test.pdf', file)\n    }\n  )\n  \n})\n",
    "created" : 1442769537956.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "803465149",
    "id" : "A1447AFB",
    "lastKnownWriteTime" : 1442772176,
    "path" : "~/shiny-server/server.R",
    "project_path" : "server.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}